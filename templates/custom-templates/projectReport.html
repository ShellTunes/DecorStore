{% extends 'admin/base.html' %} 
{% load static %}
{% block title %}Project Report{% endblock %} 
{% block content %}


<div class="card card-info">
    <div class="card-header">
      <h3 class="card-title">Project Report</h3>
    </div>
  </div>
  <!-- /.card -->
  <div class="card-body" style="overflow:auto">
    
    <form method="get">
      {% csrf_token %}
      <div class="row">

      <div class="col-md-3">
        <div class="form-group">
          <label>Glass <span style = "color:red">*</span></label>
          <select name ='glass' id= 'glass' class="form-control select2bs4" style="width: 100%;" required>
            <option value=''>-----</option>
            
            <option value="ClearGlass">Clear Glass</option>
            <option value="ToughenedGlass">Toughened Glass</option>
            
          </select>
        </div>
      </div>

      <div class="col-md-3">
          <div class="form-group">
              <label style='margin-left: 43px;'>From Date:</label>
                <div class="input-group date" data-target-input="nearest" >
                    <input type="date" name ='fromdate' id="fromdate"  style= "margin-left: 40px; width: 70%" data-target="#reservationdate" required/>
                    <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                    </div>
                </div>
          </div>
      </div>
      <div class="col-md-3">
        <div class="form-group">
            <label style='margin-left: 18px;'>To Date:</label>
              <div class="input-group date" data-target-input="nearest" >
                  <input type="date"  style='margin-left: 20px;width: 70%'  name ='todate' id="todate" data-target="#reservationdate" required/>
                  <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                  </div>
              </div>
        </div>
    </div>
      
        <div class="col-1">
          <div class="form-group" style= "margin-top: 29px;">
          {% comment %} {% bootstrap_button 'Filter' button_class="btn-secondary" %} {% endcomment %}
          <button type="submit" class="btn btn-primary mr-3 mt-3 btn-block">Ok</button>
          </div>
        </div>
        <div class="col-1" style= "margin-top: 12px;">
          {% comment %} {% bootstrap_button 'Filter' button_class="btn-secondary" %} {% endcomment %}
          <a href="{% url 'projectReport' %}" class="btn btn-secondary mr-3 mt-3 btn-block">Clear</a>
        </div>
        {% comment %} <div id="excel-button" class="col-1" style= "margin-top: 12px;">
            <a type="submit" class="btn btn-success btn-block  mt-3">Excel</a>
          </div> {% endcomment %}
      <!-- /.col -->
    </div>
  
  </form>

    <!-- /.row -->
  </div>
<table id="example" class="display" style="width:100%">
    <thead>
        <tr>
            <th>Sl.No</th>
            <th>Date</th>
            <th>Clear/Toughened</th>
            <th>Quote No</th>
            <th>Project Name</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
        {% for srl in projectreport %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{srl.Date}}</td>
            <td>{{srl.Glass}}</td>
            <td>{{srl.quoteno}}</td>
            <td>{{srl.ProjectName}}</td>
            <td>{{srl.Amount}}</td>
           
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
      {% with projectreport|last as last %}
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th>Total Amount</th>
            <th>{{last.totalamount}}</th>
        </tr>
        {% endwith %}
    </tfoot>
</table>

<!-- <p><b>Selected rows data:</b></p>
<pre id="example-console-rows"></pre> -->

<!-- </form> -->

{% endblock %}

{% block javascript %}
<!-- jQuery -->
<script src="/static/admin-lte/dist/js/adminlte.js"></script>
<script src="{% static 'admin-lte/plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'admin-lte/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- Select2 -->
<script src="{% static 'admin-lte/plugins/select2/js/select2.full.min.js' %}"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="{% static 'admin-lte/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>
<link href="https://rawgit.com/select2/select2/master/dist/css/select2.min.css" rel="stylesheet"/>
<script src="https://rawgit.com/select2/select2/master/dist/js/select2.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet"/>
<!-- InputMask -->
<script src="{% static 'admin-lte/plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/inputmask/jquery.inputmask.min.js' %}"></script>

<script src="{% static 'admin-lte/plugins/daterangepicker/daterangepicker.js' %}"></script>

  <link rel="stylesheet" type="text/css" 
  href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">

  <link rel="stylesheet" type="text/css" href="{% static 'admin/css/stockreport.css' %}" />


  {% comment %} <script src="{% static 'admin/js/stockreport.js' %}"></script> {% endcomment %}

  <script type="text/javascript" charset="utf8" 
  src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
  
  <link type="text/css" href="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/css/dataTables.checkboxes.css" rel="stylesheet" />
  <script type="text/javascript" src="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/js/dataTables.checkboxes.min.js"></script>

<script>
$(document).ready(function() {
  $('#example').dataTable({
    "bPaginate": false
});
});

$(document).ready(function () {
  $(function () {
  console.log('hello')
  $('#glass').select2({
      matcher: function (params, data) {
        if ($.trim(params.term) === '') {
            return data;
        }
  
        keywords=(params.term).split(" ");
  
        for (var i = 0; i < keywords.length; i++) {
            if (((data.text).toUpperCase()).indexOf((keywords[i]).toUpperCase()) == -1) 
            return null;
        }
        return data;
    }
  });
})
})

{% comment %} $("#excel-button").click(function() {
    var glass = $("#glass :selected").val(); 
    var fromdate = $("#fromdate").val();
    var todate = $("#todate").val();
    
    
    var data = `{"glass":"${glass}","fromdate":"${fromdate}","todate":"${todate}"}`;
    let request = new XMLHttpRequest();
    request.open('POST', '{%url "projectReportshow"%}', true);
    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
    // request.setRequestHeader('Content-Type', 'application/json');
    request.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
    request.responseType = 'blob';
  
    request.onload = function (e) {
        if (this.status === 200) {
            let filename = "";
            let disposition = request.getResponseHeader('Content-Disposition');
            // check filename
            if (disposition && disposition.indexOf('attachment') !== -1) {
                let filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                let matches = filenameRegex.exec(disposition);
                if (matches != null && matches[1]) filename = matches[1].replace(/['"]/g, '');
            }
            let blob = this.response;
            if (window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveBlob(blob, filename);
            }
            else {
                let downloadLink = window.document.createElement('a');
                let contentTypeHeader = request.getResponseHeader("Content-Type");
                downloadLink.href = window.URL.createObjectURL(new Blob([blob], {type: contentTypeHeader}));
                downloadLink.download = filename;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            }
        } else {
            alert('Download failed.')
        }
    };
    request.send(data);
  }); {% endcomment %}



$(function () {
      //Initialize Select2 Elements
    //   $('.select2').select2()

    //   //Initialize Select2 Elements
    //   $('.select2bs4').select2({
    //     theme: 'bootstrap4'
    //   })

      //Datemask dd/mm/yyyy
      $('#datemask').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
      //Datemask2 mm/dd/yyyy
      $('#datemask2').inputmask('mm/dd/yyyy', { 'placeholder': 'mm/dd/yyyy' })
      //Money Euro
      $('[data-mask]').inputmask()

      //Date range picker
    //   $('#reservationdate').datepicker();
    $(document).ready(function() {
          
         /** $(function() {
              $( "#reservationdate" ).datepicker();
              $('.date-picker').on("click", function() {
                $( "#reservationdate" ).datepicker('show');
              })
          });**/
      })
      //Date range picker
    //   $('#reservation').daterangepicker()
      //Date range picker with time picker
      $('#reservationtime').daterangepicker({
        timePicker: true,
        timePickerIncrement: 30,
        locale: {
          format: 'MM/DD/YYYY hh:mm A'
        }
      })
      //Date range as a button
      $('#daterange-btn').daterangepicker(
        {
          ranges   : {
            'Today'       : [moment(), moment()],
            'Yesterday'   : [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days' : [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month'  : [moment().startOf('month'), moment().endOf('month')],
            'Last Month'  : [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          },
          startDate: moment().subtract(29, 'days'),
          endDate  : moment()
        },
        function (start, end) {
          $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))
        }
      )

      //Timepicker
    //   $('#timepicker').datetimepicker({
    //     format: 'LT'
    //   })

      //Bootstrap Duallistbox
      $('.duallistbox').bootstrapDualListbox()

      $("input[data-bootstrap-switch]").each(function(){
        $(this).bootstrapSwitch('state', $(this).prop('checked'));
      });

    })


</script>

{% endblock %}